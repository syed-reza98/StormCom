*** Begin Patch
*** Update File: specs/001-multi-tenant-ecommerce/spec.md
@@
 ### Internationalization (Phase 1 Scope)
@@
 **Date/Time Format**: ISO 8601 in API; localized display in UI (YYYY-MM-DD for en-US, DD/MM/YYYY for en-GB based on user locale).
+
+### Design System & UI/UX Principles
+
+StormCom adopts a comprehensive, token-driven design system to ensure consistency, accessibility, and performance across **SMB dashboards**, **B2B admin portals**, and **consumer storefronts**:
+
+**Framework & Libraries**
+- **Next.js App Router + React 19** (RSC-first), **TypeScript (strict)**.
+- **Tailwind CSS v4** with **CSS variables** for semantic tokens.
+- **Radix UI** primitives + **shadcn/ui** components (copy-in) for accessible building blocks.
+- **Storybook** is the source of truth for component specs, states, and a11y checks.
+
+**Tokens & Theming**
+- Colors: `--color-bg`, `--color-fg`, `--color-muted`, `--color-border`, `--color-ring`, semantic `--color-primary|secondary|success|warning|danger|info` (+ on-color for text).
+- Typography: `--font-sans`, `--font-mono`, optical sizes from **body/sm..lg** to **h1..h6**; tabular numerals for data views.
+- Spacing: 4/8-pt ramp; radii `sm|md|lg|xl`; elevations `e1..e5`; z-index map for header/drawer/modal/toast/tooltip.
+- Dark mode via `.dark` on `<html>`; set `color-scheme: dark` to style native UI.
+- Per-tenant branding from **Store.primaryColor / secondaryColor / fontFamily** injected as CSS variables at runtime.
+
+**Layout & Responsiveness**
+- 12-col grid on desktop; fluid single-column on mobile; breakpoints: `sm(640)`, `md(768)`, `lg(1024)`, `xl(1280)`, `2xl(1536)`.
+- Content max-widths to maintain readable line lengths; adaptive tables/cards; mobile bottom-sheet patterns for menus/filters.
+
+**Components & Patterns**
+- Buttons (primary/secondary/tertiary/destructive), inputs (text/textarea/select/combobox), dialogs/drawers, tabs/accordion, table (sort/filter/paginate), toasts/alerts, skeletons.
+- Auth pages (login/register/mfa), dashboard shells, storefront product cards, PDP, cart, checkout, order timeline.
+- Charts follow accessible palettes; KPI tiles with deltas and consistent number formatting.
+
+**Accessibility (AA)**
+- Semantic HTML first; ARIA only where necessary. Keyboard support (Tab/Shift+Tab, arrow keys), visible `:focus-visible` ring.
+- **Hit targets â‰¥44Ã—44** on touch; APCA-based contrast for rest/hover/focus/active in light & dark themes.
+- Live regions for async updates; skip-to-content link; reduced-motion support.
+
+**Documentation & Quality Gates**
+- Each component has Storybook stories (light/dark/RTL/reduced-motion) + a11y checks.
+- Playwright E2E a11y smoke tests for: Auth, Product List, PDP, Cart/Checkout.
+
+### Theming & Multi-Tenant Overrides
+- Inject tenant branding via CSS variables on `<html data-tenant="...">`; Tailwind utilities read vars (e.g., `bg-primary`).
+- Contrast is validated at runtime for custom tenant colors; fall back to safe palette on failure.
+
+### Design Ops & Governance
+- Any UI change must update Storybook stories and pass a11y checks in CI.
+- New components include usage notes and do/donâ€™t examples in `docs/design-system.md`.
*** End Patch

*** Begin Patch
*** Update File: specs/001-multi-tenant-ecommerce/plan.md
@@
 ## UI Requirements
 (see also: Design & Styling Standards)
+
+## Design System Implementation Plan
+
+### Phase 1 â€” Foundations
+1) **Tailwind v4 tokenization** â€” define semantic tokens in `tailwind.config.ts` (colors/typography/radii/elevations/z-index).
+2) **Global CSS** â€” `app/styles/globals.css` declares light/dark variables; `data-theme` switch with persisted preference.
+3) **Storybook setup** â€” `@storybook/nextjs` with a11y, interactions, viewport, docs; decorators for theme, locale, and layout shells.
+
+### Phase 2 â€” Primitives & Patterns
+1) **Radix + shadcn wiring** â€” Button, Input, Label, Select, Dialog, Toast, Tabs, Accordion, Table; tokenized states.
+2) **Layout shells** â€” `DashboardShell` / `StorefrontLayout` (12-col grid, page header, breadcrumbs, toolbar slot).
+3) **A11y & quality** â€” keyboard coverage, APCA contrast verification, Playwright a11y smoke tests for core flows.
+
+### Phase 3 â€” Tenant Theming & Docs
+1) **Per-tenant branding** â€” load Store branding and inject CSS variables; verify contrast for both themes.
+2) **Docs & governance** â€” `docs/design-system.md` + Storybook as living contract; token changes gated via changesets.
+
+### Deliverables
+- Tailwind config + `globals.css`, Storybook with theming toggles, baseline component library wired to Radix/shadcn.
+- CI gates: Storybook build, a11y checks, visual regression threshold.
*** End Patch

*** Begin Patch
*** Update File: specs/001-multi-tenant-ecommerce/tasks.md
@@
 ## UI/UX Tasks
-- [ ] T009a â€” Establish Tailwind v4 config with semantic tokens
-- [ ] T009b â€” Create `globals.css` with light/dark variables
-- [ ] T009c â€” Wire Radix/shadcn primitives to tokens
-- [ ] T009d â€” Add Storybook and docs for components
-- [ ] T009e â€” Implement dark mode toggle and persistence
-- [ ] T009f â€” Add focus-visible and keyboard navigation patterns
-- [ ] T009g â€” Verify APCA contrast for interactive states
-- [ ] T009h â€” Hook tenant theme fields (primary/secondary/font) to CSS variables
+- [ ] T009a â€” Tailwind v4 config with semantic tokens  
+      **Acceptance**: tokens available as CSS vars; Tailwind theme extended for colors/typography/radii/elevations/z-index.
+- [ ] T009b â€” `globals.css` with light/dark variables  
+      **Acceptance**: `.dark` + `color-scheme: dark`; base styles apply tokens; focus ring utility present.
+- [ ] T009c â€” Wire Radix/shadcn primitives to tokens  
+      **Acceptance**: Button/Input/Select/Dialog/Tabs/Table consume tokens; states use tokenized vars.
+- [ ] T009d â€” Storybook & docs for components  
+      **Acceptance**: a11y, interactions, viewport addons; stories include light/dark/RTL/reduced-motion; MDX usage notes.
+- [ ] T009e â€” Dark mode toggle & persistence  
+      **Acceptance**: `data-theme` persisted; SSR hydration safe; native UI follows `color-scheme`.
+- [ ] T009f â€” Keyboard navigation patterns  
+      **Acceptance**: visible `:focus-visible`; skip-to-content link; menus/dialogs follow ARIA patterns.
+- [ ] T009g â€” APCA contrast verification  
+      **Acceptance**: rest/hover/focus/active contrast pass in both themes; failures fail CI.
+- [ ] T009h â€” Tenant branding hook  
+      **Acceptance**: Store `primaryColor`/`secondaryColor`/`fontFamily` inject to CSS vars at runtime; reflected without rebuild.
+
+### New tasks
+- [ ] T010 â€” Layout shells (`DashboardShell`, `StorefrontLayout`)  
+      **Acceptance**: 12-col grid, page header, breadcrumb, toolbar slot; examples in Storybook.
+- [ ] T011 â€” Playwright a11y smoke tests  
+      **Acceptance**: Auth, Product List, PDP, Cart/Checkout pass axe; CI job green.
+- [ ] T012 â€” Tokens export & governance  
+      **Acceptance**: `tokens.json` published; changesets gate token changes; `docs/design-system.md` updated.
*** End Patch

*** Begin Patch
*** Update File: specs/001-multi-tenant-ecommerce/data-model.md
@@
 ### 1. Store (Tenant)
@@
-  // Theme and branding
-  logoUrl      String?
-  faviconUrl   String?
-  primaryColor String @default("#000000")
-  secondaryColor String @default("#FFFFFF")
-  fontFamily    String?  // Optional custom font family override
+  // Theme and branding
+  logoUrl        String?
+  faviconUrl     String?
+  primaryColor   String @default("#000000")  // semantic --color-primary
+  secondaryColor String @default("#FFFFFF")  // semantic --color-secondary
+  fontFamily     String?                     // optional font override (CSS var)
@@
 ## Additional Supporting Entities
+
+### ConsentEvent
+Records changes to user consent (e.g., marketing opt in/out) for auditability and DSAR responses.
+
+```prisma
+model ConsentEvent {
+  id           String   @id @default(cuid())
+  createdAt    DateTime @default(now())
+  storeId      String
+  store        Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)
+  customerId   String?
+  customer     Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
+  subjectEmail String
+  type         ConsentType
+  source       String?   // "ui", "import", "api"
+  userAgent    String?
+  ipAddress    String?
+  note         String?
+
+  @@index([storeId, subjectEmail, type])
+}
+
+enum ConsentType {
+  MARKETING_OPT_IN
+  MARKETING_OPT_OUT
+  TRACKING_OPT_OUT
+}
+```
*** End Patch
