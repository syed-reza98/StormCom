version: 2

updates:
  # npm dependency updates - batch minor/patch updates into one Dependabot PR
  - package-ecosystem: "npm"
    directory: "/"
    target-branch: "main"            # explicitly target main
    schedule:
      interval: "daily"              # keep daily for fast security/patch cadence
      time: "03:00"                  # off-peak UTC
    open-pull-requests-limit: 1      # keep one batched PR at a time for npm
    reviewers:
      - "CodeStorm-Hub"
    labels:
      - "dependencies"
      - "npm"
      - "automated"
    commit-message:
      prefix: "chore(deps)"
      include: "scope"
    versioning-strategy: "increase"  # allow lockfile bumps for transitive deps

    # Group critical packages separately, then batch all remaining minor/patch updates
    groups:
      # Important framework/runtime packages handled individually
      nextjs:
        patterns:
          - "^next$"
          - "^react$"
          - "^react-dom$"
          - "^@next/.*"
        update-types:
          - "minor"
          - "patch"

      prisma:
        patterns:
          - "^@prisma/.*"
          - "^prisma$"
        update-types:
          - "minor"
          - "patch"

      # Testing and tooling grouped
      testing:
        patterns:
          - "^vitest$"
          - "^@vitest/.*"
          - "^@testing-library/.*"
          - "^playwright$"
          - "^@playwright/.*"
        update-types:
          - "minor"
          - "patch"

      code-quality:
        patterns:
          - "^eslint"
          - "^eslint-.*"
          - "^@eslint/.*"
          - "^prettier$"
          - "^typescript$"
          - "^typescript-eslint"
          - "^@typescript-eslint/.*"
        update-types:
          - "minor"
          - "patch"

      ui-libraries:
        patterns:
          - "^@radix-ui/.*"
          - "^tailwindcss$"
          - "^@tailwindcss/.*"
          - "^lucide-react$"
          - "^framer-motion$"
        update-types:
          - "minor"
          - "patch"

      # Catch-all: everything else (minor/patch) will be batched into a single PR
      batched-minor-patch:
        patterns:
          - "*"                        # match remaining packages not caught by above groups
        update-types:
          - "minor"
          - "patch"

    # Ignore major version updates for packages that require manual review and planning
    ignore:
      - dependency-name: "next"
        update-types: ["version-update:semver-major"]
      - dependency-name: "react"
        update-types: ["version-update:semver-major"]
      - dependency-name: "react-dom"
        update-types: ["version-update:semver-major"]
      - dependency-name: "typescript"
        update-types: ["version-update:semver-major"]

  # GitHub Actions updates (kept separate - cannot be combined with npm updates)
  - package-ecosystem: "github-actions"
    directory: "/"
    target-branch: "main"
    schedule:
      interval: "weekly"
      day: "tuesday"
      time: "04:00"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "github-actions"
    commit-message:
      prefix: "ci"
      include: "scope"

  # Docker updates â€” enable when Dockerfiles are present
  # - package-ecosystem: "docker"
  #   directory: "/"
  #   target-branch: "main"
  #   schedule:
  #     interval: "weekly"
  #     day: "tuesday"
  #     time: "04:00"
  #   labels:
  #     - "dependencies"
  #     - "docker"
